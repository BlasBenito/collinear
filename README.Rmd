---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  eval = TRUE,
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
# options(tibble.print_min = 5, tibble.print_max = 5)
```


# `collinear` \n Automated Multicollinearity Management <a href="https://github.com/BlasBenito/collinear"><img src="man/figures/logo.png" align="right" height="138" /></a>



<!-- Development badges 

[![R-CMD-check](https://github.com/BlasBenito/collinear/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/BlasBenito/collinear/actions/workflows/R-CMD-check.yaml)
[![Devel-version](https://img.shields.io/badge/devel%20version-1.0.1-blue.svg)](https://github.com/blasbenito/collinear)

<!-- badges: start -->

[![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.10039489.svg)](https://doi.org/10.5281/zenodo.10039489)
[![CRAN status](https://www.r-pkg.org/badges/version/collinear)](https://cran.r-project.org/package=collinear)
[![CRAN\_Download\_Badge](http://cranlogs.r-pkg.org/badges/grand-total/collinear)](https://CRAN.R-project.org/package=collinear)
[![R-CMD-check](https://github.com/BlasBenito/collinear/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/BlasBenito/collinear/actions/workflows/R-CMD-check.yaml)

<!-- badges: end -->

## Warning

Version 3.0.0 of `collinear` includes changes that may disrupt existing workflows, and results from previous versions may not be reproducible due to enhancements in the automated selection algorithms.

## Summary

[Multicollinearity hinders the interpretability](https://www.blasbenito.com/post/multicollinearity-model-interpretability/) of linear and machine learning models.

The `collinear` package combines four methods for easy management of multicollinearity in modelling data frames with numeric and categorical variables:

- **Target Encoding**: Transforms categorical predictors to numeric using a numeric response as reference.
- **Preference Order**: Ranks predictors by their association with a response variable to preserve important ones in multicollinearity filtering.
- **Pairwise Correlation Filtering**: Automated multicollinearity filtering of numeric and categorical predictors based on pairwise correlations.
- **Variance Inflation Factor Filtering**: Automated multicollinearity filtering of numeric predictors based on Variance Inflation Factors.

These four methods are combined in the functions `collinear()` and `collinear_auto()`, which serves as single entry point for most of the functionalities in the package. The article [How It Works](https://blasbenito.github.io/collinear/articles/how_it_works.html) explains how these functions work in detail.

## Citation

If you find this package useful, please cite it as:

*Blas M. Benito (2025). collinear: R Package for Seamless Multicollinearity Management. Version 3.0.0. doi: 10.5281/zenodo.10039489*

## Install

The package `collinear` can be installed from CRAN.

```{r, eval = FALSE}
install.packages("collinear")
```


The development version can be installed from GitHub.

```{r, eval = FALSE}
remotes::install_github(
  repo = "blasbenito/collinear", 
  ref = "development"
  )
```


Previous versions are in the “archive_xxx” branches of the GitHub repository.

```{r, eval = FALSE}
remotes::install_github(
  repo = "blasbenito/collinear", 
  ref = "archive_v2.0.0"
  )
```


## Getting Started

The function `collinear_auto()` has the lowest entry barrier, as it handles multicollinearity management all by itself.

```{r}
library(collinear)
library(future)

#parallelization setup
#only worth it for large data with categorical predictors
future::plan(
  future::multisession,
  workers = future::availableCores() - 1
  )

#progress bar (does not work in Rmarkdown)
#progressr::handlers(global = TRUE)

#multicollinearity filtering
#two responses
#numeric and categorical predictors
x <- collinear::collinear_auto(
  df = collinear::vi_smol,
  response = c(
    "vi_numeric",    #numeric response
    "vi_categorical" #categorical response
    ),
  predictors = collinear::vi_predictors,
  quiet = TRUE #set to FALSE to see all messages
)
```

The output is a list of class `collinear_output`, that has a proper `print()` method.

```{r}
x
```
The function `vif_df()` provides the simplest way to check that the variable selections returned by `collinear_auto()` show low multicollinearity.

```{r}
vif_df(
  df = x$vi_numeric$df,
  predictors = x$vi_numeric$selection
)
```

```{r}
vif_df(
  df = x$vi_categorical$df,
  predictors = x$vi_categorical$selection
)
```
The output of `preference_order()` computed internally by `collinear_auto()` and used to preserve important predictors is available in the function's output. For example, for the response `vi_numeric`, the R-squared of the observations vs the predictors of a GLM fitted on the response against each predictor was used to ran the predictors.

```{r}
x$vi_numeric$preference_order
```

We can also use the results of `collinear_output()` to fit exploratory models. For example, for the response `vi_numeric` we can fit a GLM.

```{r}
m <- stats::glm(
  formula = x$vi_numeric$formulas$linear, 
  data = x$vi_numeric$df,
  na.action = na.omit
  )

summary(m)
```

For `vi_categorical`, a factor variable, we can fit a classification model with Random Forest:

```{r, eval = FALSE}
m <- ranger::ranger(
  formula = x$vi_categorical$formulas$classification,
  data = x$vi_categorical$df
)

print(m)
```

## Getting help

If you encounter bugs or issues with the documentation, please [file a issue on GitHub](https://github.com/BlasBenito/collinear/issues).
