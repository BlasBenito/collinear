---
output: github_document
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  eval = TRUE,
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
# options(tibble.print_min = 5, tibble.print_max = 5)
```


# `collinear` \n Automated Multicollinearity Management <a href="https://github.com/BlasBenito/collinear"><img src="man/figures/logo.png" align="right" height="138" /></a>



<!-- Development badges 

[![R-CMD-check](https://github.com/BlasBenito/collinear/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/BlasBenito/collinear/actions/workflows/R-CMD-check.yaml)
[![Devel-version](https://img.shields.io/badge/devel%20version-1.0.1-blue.svg)](https://github.com/blasbenito/collinear)

<!-- badges: start -->

[![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.10039489.svg)](https://doi.org/10.5281/zenodo.10039489)
[![CRAN status](https://www.r-pkg.org/badges/version/collinear)](https://cran.r-project.org/package=collinear)
[![CRAN\_Download\_Badge](http://cranlogs.r-pkg.org/badges/grand-total/collinear)](https://CRAN.R-project.org/package=collinear)
[![R-CMD-check](https://github.com/BlasBenito/collinear/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/BlasBenito/collinear/actions/workflows/R-CMD-check.yaml)

<!-- badges: end -->

## Warning

Version 3.0.0 of `collinear` includes changes that may disrupt existing workflows, and results from previous versions may not be reproducible due to enhancements in the predictor selection algorithm.

## Summary

[Multicollinearity hinders the interpretability](https://www.blasbenito.com/post/multicollinearity-model-interpretability/) of linear and machine learning models. 

The R package `collinear` provides a comprehensive toolkit for automated multicollinearity management in datasets with mixed variable types (numeric, categorical, and logical).

It is built around these concepts:

 - **Target Encoding Integration** (function [target_encoding_lab()]): Transparently converts categorical predictors to numeric when required, enabling VIF and correlation analysis across mixed data types.

 - **Unified Correlation Framework** (function [cor_df()]): Computes pairwise correlations between any variable types using Pearson correlation (numeric-numeric), target encoding (numeric-categorical), and Cramer's V (categorical-categorical) within a single, consistent workflow.

 - **Intelligent Predictor Ranking** (function [preference_order()]): Prioritizes predictors by their association with the response, or allows a user-defined ranking to ensure that the most relevant ones are retained during filtering.

- **Dual Filtering Strategy** (function [collinear_select()]): Combines pairwise correlation and Variance Inflation Factor filtering while considering predictor rankings to manage multicollinearity while maximizing the predictive power of the resulting selection of predictors.

These methods are integrated in two main functions:

 - [collinear()]: Handles the complete workflow from data validation to variable selection, returning filtered datasets and modeling formulas. 

The package also provides diagnostic functions ([cor_df()], [vif_df()], [collinear_stats()]) to help users assess multicollinearity in their data before and after filtering.

## Install

The package `collinear` can be installed from CRAN.

```{r, eval = FALSE}
install.packages("collinear")
```


The development version can be installed from GitHub.

```{r, eval = FALSE}
remotes::install_github(
  repo = "blasbenito/collinear", 
  ref = "development"
  )
```


Previous versions are in the “archive_xxx” branches of the GitHub repository.

```{r, eval = FALSE}
remotes::install_github(
  repo = "blasbenito/collinear", 
  ref = "archive_v2.0.0"
  )
```


## Getting Started

### Setup

Most functions in the `collinear` package support parallelization and progress bars via [`future`](https://future.futureverse.org/) and [`progressr`](https://progressr.futureverse.org/). 


```{r}
library(collinear)
library(future)
library(progressr)

future::plan(
  future::multisession,
  workers = future::availableCores() - 1
  )

#does not work in Rmarkdown
#progressr::handlers(global = TRUE)
```

### Example Data

The example dataframe [vi] has several response variables and a large set of predictors. Here we focus on the numeric response `vi_numeric`, and the complete set of numeric and categorical predictors, stored in the vector [vi_predictors].

```{r}
data(vi, vi_predictors)
nrow(vi)
length(vi_predictors)
```

The function [identify_valid_variables()] is used below to check the types of the predictors.

```{r}
collinear::identify_valid_variables(
  df = vi,
  predictors = vi_predictors
)
```
### Multicollinearity Analysis

The package provides several functions to assess multicollinearity. 

The functions [cor_df()] and [vif_df()] generate dataframes with the pairwise correlations and VIF scores of the predictors, while the functions [cor_stats()],  [vif_stats()] (used below) and [collinear_stats()] generate descriptive multicollinearity statistics.

```{r}
collinear::vif_stats(
  df = vi,
  predictors = vi_predictors,
  quiet = TRUE
)
```
The quantile 0.75 returned by `vif_stats()` indicates that 25% of the predictors have a VIF score higher than 10. This is a robust indicator of high multicollinearity in our modelling data.

### Multicollinearity Filtering

The function [collinear()] is designed to reduce multicollinearity in complex modelling data with a minimal setup. In this case, it performs the following actions:

```{r}
x <- collinear::collinear(
  df = vi,
  response = "vi_numeric",
  predictors = vi_predictors
)
```

The functions `collinear()` and `collinear()` return an object of class `collinear_output`, that has its own `print()` method.

```{r}
x
```

The object `selection` contains predictors chosen by `collinear()`. We can use [vif_df()] to check their level of multicollinearity.

```{r}
vif_df(
  df = x$vi_numeric$df,
  predictors = x$vi_numeric$selection
)
```
All VIF scores are below 2.5, meaning that `collinear()` did a good job here.

### Model Fitting

The output of `collinear()` can be used right away to fit exploratory models, as shown below.

```{r}
m.lm <- stats::lm(
  formula = x$vi_numeric$formulas$linear, 
  data = x$vi_numeric$df,
  na.action = na.omit
  )

summary(m)
```

```{r}
m.gam <- mgcv::gam(
  formula = x$vi_numeric$formulas$smooth, 
  data = x$vi_numeric$df
  )

summary(m.gam)
```


## Citation

If you find this package useful, please cite it as:

*Blas M. Benito (2025). collinear: R Package for Seamless Multicollinearity Management. Version 3.0.0. doi: 10.5281/zenodo.10039489*

## Getting help

If you encounter bugs or issues with the documentation, please [file a issue on GitHub](https://github.com/BlasBenito/collinear/issues).
