<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Target Encoding • collinear</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Target Encoding">
<link rel="stylesheet" href="extra.css">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">collinear</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/unified_correlation_framework.html">Unified Correlation Framework</a></li>
    <li><a class="dropdown-item" href="../articles/intelligent_predictor_ranking.html">Intelligent Predictor Ranking</a></li>
    <li><a class="dropdown-item" href="../articles/target_encoding.html">Target Encoding</a></li>
    <li><a class="dropdown-item" href="../articles/adaptive_filtering_thresholds.html">Adaptive Filtering Thresholds</a></li>
    <li><a class="dropdown-item" href="../articles/dual_filtering_strategy.html">Dual Filtering Strategy</a></li>
    <li><a class="dropdown-item" href="../articles/collinear_in_the_wild.html">collinear In The Wild</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-blog-posts" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Blog Posts</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-blog-posts">
<li><a class="external-link dropdown-item" href="https://www.blasbenito.com/post/multicollinearity-model-interpretability/">Multicollinearity Hinders Model Interpretability</a></li>
    <li><a class="external-link dropdown-item" href="https://www.blasbenito.com/post/variance-inflation-factor/">Everything About Variance Inflation Factors</a></li>
    <li><a class="external-link dropdown-item" href="https://www.blasbenito.com/post/target-encoding/">Mapping Categorical Predictors to Numeric</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/blasbenito/collinear/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Target Encoding</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/blasbenito/collinear/blob/main/vignettes/articles/target_encoding.Rmd" class="external-link"><code>vignettes/articles/target_encoding.Rmd</code></a></small>
      <div class="d-none name"><code>target_encoding.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="summary">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<p><a href="https://www.blasbenito.com/post/target-encoding/" class="external-link"><strong>Target
encoding</strong></a> maps categorical predictors to a statistic of a
reference numeric variable across categories.</p>
<p>This functionality, implemented in
<code><a href="../reference/target_encoding_lab.html">target_encoding_lab()</a></code>, is used in two different ways:</p>
<ul>
<li>The function <code><a href="../reference/cor_df.html">cor_df()</a></code> applies it to compute pairwise
correlations between numeric and categorical predictors, if any.</li>
<li>The function <code><a href="../reference/collinear.html">collinear()</a></code> applies it optionally if the
user requests it and the response is numeric to transform all
categorical predictors to numeric and speed-up the multicollinearity
analysis.</li>
</ul>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>The code chunk below prepares the session for this article.</p>
</div>
<div class="section level2">
<h2 id="how-it-works">How It Works<a class="anchor" aria-label="anchor" href="#how-it-works"></a>
</h2>
<p>To explain how target encoding works, let’s first create a little
silly dataframe:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  num <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">6</span>,</span>
<span>  cat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"a"</span>, <span class="fl">3</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"b"</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span></span>
<span><span class="co">#&gt;   num cat</span></span>
<span><span class="co">#&gt; 1   1   a</span></span>
<span><span class="co">#&gt; 2   2   a</span></span>
<span><span class="co">#&gt; 3   3   a</span></span>
<span><span class="co">#&gt; 4   4   b</span></span>
<span><span class="co">#&gt; 5   5   b</span></span>
<span><span class="co">#&gt; 6   6   b</span></span></code></pre></div>
<div class="section level3">
<h3 id="mean-target-encoding">Mean Target Encoding<a class="anchor" aria-label="anchor" href="#mean-target-encoding"></a>
</h3>
<p>To transform <code>cat</code> to numeric we can remap it to the
average of <code>num</code> across each category in <code>cat</code>, as
shown in the code below using the <code>dplyr</code> syntax.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">cat</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>cat_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">num</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;     num cat   cat_mean</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 a            2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2 a            2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3 a            2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     4 b            5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     5 b            5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     6 b            5</span></span></code></pre></div>
<p>This is equivalent to the <code>"mean"</code> encoding method
implemented in <code><a href="../reference/target_encoding_lab.html">target_encoding_lab()</a></code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">collinear</span><span class="fu">::</span><span class="fu"><a href="../reference/target_encoding_lab.html">target_encoding_lab</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">df</span>,</span>
<span>  response <span class="op">=</span> <span class="st">"num"</span>,</span>
<span>  predictors <span class="op">=</span> <span class="st">"cat"</span>,</span>
<span>  methods <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span></span>
<span><span class="co">#&gt;   num cat cat__encoded_loo</span></span>
<span><span class="co">#&gt; 1   1   a              2.5</span></span>
<span><span class="co">#&gt; 2   2   a              2.0</span></span>
<span><span class="co">#&gt; 3   3   a              1.5</span></span>
<span><span class="co">#&gt; 4   4   b              5.5</span></span>
<span><span class="co">#&gt; 5   5   b              5.0</span></span>
<span><span class="co">#&gt; 6   6   b              4.5</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="leave-one-out-target-encoding">Leave-One-Out Target Encoding<a class="anchor" aria-label="anchor" href="#leave-one-out-target-encoding"></a>
</h3>
<p>Another encoding method is the leave-one-out (<code>"loo"</code>),
which computes the group mean while excluding the current
observation.</p>
<p>For each given case, it sums the numeric values in the same category,
subtracts the current row’s value, and divides by the count of
observations in that category minus one. The code below replicates this
behavior.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">cat</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    cat_loo <span class="op">=</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">num</span><span class="op">)</span> <span class="op">-</span> <span class="va">num</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;     num cat   cat__encoded_loo cat_loo</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 a                  2.5     2.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2 a                  2       2  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3 a                  1.5     1.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     4 b                  5.5     5.5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     5 b                  5       5  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     6 b                  4.5     4.5</span></span></code></pre></div>
<p>Notice how the encoded values now vary within each category. For
category “a”: rows get values based on the other two observations in
“a”, and the same happens with “b”.</p>
<p>The same method can be applied in <code><a href="../reference/target_encoding_lab.html">target_encoding_lab()</a></code>
when setting <code>method</code> to <code>"loo"</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">collinear</span><span class="fu">::</span><span class="fu"><a href="../reference/target_encoding_lab.html">target_encoding_lab</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">df</span>,</span>
<span>  response <span class="op">=</span> <span class="st">"num"</span>,</span>
<span>  predictors <span class="op">=</span> <span class="st">"cat"</span>,</span>
<span>  methods <span class="op">=</span> <span class="st">"loo"</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span></span>
<span><span class="co">#&gt;   num cat cat__encoded_loo</span></span>
<span><span class="co">#&gt; 1   1   a              2.5</span></span>
<span><span class="co">#&gt; 2   2   a              2.0</span></span>
<span><span class="co">#&gt; 3   3   a              1.5</span></span>
<span><span class="co">#&gt; 4   4   b              5.5</span></span>
<span><span class="co">#&gt; 5   5   b              5.0</span></span>
<span><span class="co">#&gt; 6   6   b              4.5</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="rank-target-encoding">Rank Target Encoding<a class="anchor" aria-label="anchor" href="#rank-target-encoding"></a>
</h3>
<p>The rank method orders categories by their mean values and assigns
them integer ranks. It is useful to capture the ordinal relationship
between categories without being sensitive to outliers or extreme
values.</p>
<p>The <code>dplyr</code> version of this algorithm is a bit more
verbose, but I hope it does the trick:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">cat</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    cat_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">num</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    cat_rank <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">dense_rank</a></span><span class="op">(</span><span class="va">cat_mean</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span><span class="va">df</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;     num cat   cat_mean cat_rank</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     1 a            2        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>     2 a            2        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>     3 a            2        1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>     4 b            5        2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>     5 b            5        2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>     6 b            5        2</span></span></code></pre></div>
<p>The same method can be applied via <code><a href="../reference/target_encoding_lab.html">target_encoding_lab()</a></code>
with <code>encoding_method = "rank"</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">collinear</span><span class="fu">::</span><span class="fu"><a href="../reference/target_encoding_lab.html">target_encoding_lab</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">df</span>,</span>
<span>  response <span class="op">=</span> <span class="st">"num"</span>,</span>
<span>  predictors <span class="op">=</span> <span class="st">"cat"</span>,</span>
<span>  methods <span class="op">=</span> <span class="st">"rank"</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">df</span></span>
<span><span class="co">#&gt;   num cat cat__encoded_loo</span></span>
<span><span class="co">#&gt; 1   1   a              2.5</span></span>
<span><span class="co">#&gt; 2   2   a              2.0</span></span>
<span><span class="co">#&gt; 3   3   a              1.5</span></span>
<span><span class="co">#&gt; 4   4   b              5.5</span></span>
<span><span class="co">#&gt; 5   5   b              5.0</span></span>
<span><span class="co">#&gt; 6   6   b              4.5</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="target-encoding-in-practice">Target Encoding in Practice<a class="anchor" aria-label="anchor" href="#target-encoding-in-practice"></a>
</h2>
<div class="section level3">
<h3 id="computing-correlations-with-mixed-variable-types">Computing Correlations with Mixed Variable Types<a class="anchor" aria-label="anchor" href="#computing-correlations-with-mixed-variable-types"></a>
</h3>
<p>When computing pairwise correlations between numeric and categorical
predictors, <code><a href="../reference/cor_df.html">cor_df()</a></code> automatically applies leave-one-out
target encoding behind the scenes.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">collinear</span><span class="fu">::</span><span class="fu"><a href="../reference/cor_df.html">cor_df</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="fu">collinear</span><span class="fu">::</span><span class="va"><a href="../reference/vi_smol.html">vi_smol</a></span>,</span>
<span>  predictors <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"soil_temperature_mean"</span>, <span class="co"># numeric</span></span>
<span>    <span class="st">"koppen_zone"</span>            <span class="co"># categorical</span></span>
<span>  <span class="op">)</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">x</span></span>
<span><span class="co">#&gt;                       x           y correlation  metric</span></span>
<span><span class="co">#&gt; 1 soil_temperature_mean koppen_zone   0.9195774 Pearson</span></span></code></pre></div>
<p>This is the same as applying <code><a href="../reference/target_encoding_lab.html">target_encoding_lab()</a></code> with
method <code>"loo"</code> and then compute the pairwise correlation with
<code><a href="https://rdrr.io/r/stats/cor.html" class="external-link">stats::cor()</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">collinear</span><span class="fu">::</span><span class="fu"><a href="../reference/target_encoding_lab.html">target_encoding_lab</a></span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="va">vi_smol</span>,</span>
<span>  response <span class="op">=</span> <span class="st">"soil_temperature_mean"</span>,</span>
<span>  predictor <span class="op">=</span> <span class="st">"koppen_zone"</span>,</span>
<span>  encoding_method <span class="op">=</span> <span class="st">"loo"</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cor</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">soil_temperature_mean</span>,</span>
<span>  y <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">koppen_zone</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.9195774</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="speeding-up-multicollinearity-analysis">Speeding Up Multicollinearity Analysis<a class="anchor" aria-label="anchor" href="#speeding-up-multicollinearity-analysis"></a>
</h3>
<p>Enabling target encoding when working with numeric responses and
categorical predictors in <code><a href="../reference/collinear.html">collinear()</a></code> provides two key
advantages:</p>
<ul>
<li>Speeds up computation considerably, and more importantly.</li>
<li>Replaces Cramer’s V associations between pairs of categorical
variables with Pearson correlations between pairs of numeric variables,
providing a more statistically sound multicollinearity assessment.</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># without target encoding</span></span>
<span><span class="va">time_without</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">result_without_encoding</span> <span class="op">&lt;-</span> <span class="fu">collinear</span><span class="fu">::</span><span class="fu"><a href="../reference/collinear.html">collinear</a></span><span class="op">(</span></span>
<span>    df <span class="op">=</span> <span class="va">vi_smol</span>,</span>
<span>    responses <span class="op">=</span> <span class="st">"vi_numeric"</span>,</span>
<span>    predictors <span class="op">=</span> <span class="va">vi_predictors_categorical</span>,</span>
<span>    encoding_method <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>    quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># with target encoding</span></span>
<span><span class="va">time_with</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.time.html" class="external-link">system.time</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">result_with_encoding</span> <span class="op">&lt;-</span> <span class="fu">collinear</span><span class="fu">::</span><span class="fu"><a href="../reference/collinear.html">collinear</a></span><span class="op">(</span></span>
<span>    df <span class="op">=</span> <span class="va">vi_smol</span>,</span>
<span>    responses <span class="op">=</span> <span class="st">"vi_numeric"</span>,</span>
<span>    predictors <span class="op">=</span> <span class="va">vi_predictors_categorical</span>,</span>
<span>    encoding_method <span class="op">=</span> <span class="st">"loo"</span>,</span>
<span>    quiet <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  encoding <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"No"</span>, <span class="st">"Yes"</span><span class="op">)</span>,</span>
<span>  seconds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">time_without</span><span class="op">[</span><span class="st">"elapsed"</span><span class="op">]</span>, <span class="va">time_with</span><span class="op">[</span><span class="st">"elapsed"</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;   encoding seconds</span></span>
<span><span class="co">#&gt; 1       No   9.949</span></span>
<span><span class="co">#&gt; 2      Yes   0.282</span></span></code></pre></div>
<p>The speed-up is considerable!</p>
<p>But that’s not the only consequence of applying target encoding.
Let’s take a look at the variable selections on each run.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result_without_encoding</span><span class="op">$</span><span class="va">vi_numeric</span><span class="op">$</span><span class="va">selection</span></span>
<span><span class="co">#&gt; [1] "koppen_zone"      "soil_type"        "biogeo_ecoregion" "country_name"    </span></span>
<span><span class="co">#&gt; attr(,"validated")</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">result_with_encoding</span><span class="op">$</span><span class="va">vi_numeric</span><span class="op">$</span><span class="va">selection</span></span>
<span><span class="co">#&gt; [1] "koppen_zone"  "subregion"    "biogeo_realm" "continent"   </span></span>
<span><span class="co">#&gt; attr(,"validated")</span></span>
<span><span class="co">#&gt; [1] TRUE</span></span></code></pre></div>
<p>The selection resulting from the run with target encoding is a bit
shorter. Why? Because without target encoding, pairwise associations
between categorical predictors are computed with Cramer’s V, which tends
to underestimate association under high cardinality (number of
categories).</p>
<p>Hence, when target encoding is applied, <code><a href="../reference/collinear.html">collinear()</a></code>
captures true multicollinearity and ensures a consistent filtering
across all predictors, no matter their type.</p>
</div>
</div>
<div class="section level2">
<h2 id="important-considerations">Important Considerations<a class="anchor" aria-label="anchor" href="#important-considerations"></a>
</h2>
<p><strong>Overfitting Risk</strong>: Mean encoding can leak information
from the response into the predictor. The leave-one-out method mitigates
this risk and is generally recommended for modeling workflows.</p>
<p><strong>Category Frequency</strong>: Target encoding works best with
categories that have sufficient observations. Categories with very few
observations may produce unstable encoded values.</p>
<p><strong>When to Use Target Encoding</strong>: Enable
<code>encoding_method = "loo"</code> in <code><a href="../reference/collinear.html">collinear()</a></code> when
you have a numeric response and categorical predictors, and you want the
most accurate multicollinearity assessment. The improved statistical
soundness and computational speed make it the preferred approach for
mixed data types.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://blasbenito.com" class="external-link">Blas M. Benito</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
