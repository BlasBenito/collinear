<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Convert categorical predictors to numeric via target encoding — target_encoding_lab • collinear</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet"><meta property="og:title" content="Convert categorical predictors to numeric via target encoding — target_encoding_lab"><meta name="description" content="Target encoding maps the values of categorical variables (of class character or factor) to numeric using another numeric variable as reference. The encoding methods implemented here are:

&quot;mean&quot; (implemented in target_encoding_mean()): Maps each category to the average of reference numeric variable across the category cases. Variables encoded with this method are identified with the suffix &quot;__encoded_mean&quot;. It has a method to control overfitting implemented via the argument smoothing. The integer value of this argument indicates a threshold in number of rows. Categories sized above this threshold are encoded with the group mean, while groups below it are encoded with a weighted mean of the group's mean and the global mean. This method is named &quot;mean smoothing&quot; in the relevant literature.
&quot;rank&quot; (implemented in target_encoding_rank()): Returns the rank of the group as a integer, being 1 he group with the lower mean of the reference variable. Variables encoded with this method are identified with the suffix &quot;__encoded_rank&quot;.
&quot;loo&quot; (implemented in target_encoding_loo()): Known as the &quot;leave-one-out method&quot; in the literature, it encodes each categorical value with the mean of the response variable across all other group cases. This method controls overfitting better than &quot;mean&quot;. Variables encoded with this method are identified with the suffix &quot;__encoded_loo&quot;.


Accepts a parallelization setup via future::plan() and a progress bar via progressr::handlers() (see examples)."><meta property="og:description" content="Target encoding maps the values of categorical variables (of class character or factor) to numeric using another numeric variable as reference. The encoding methods implemented here are:

&quot;mean&quot; (implemented in target_encoding_mean()): Maps each category to the average of reference numeric variable across the category cases. Variables encoded with this method are identified with the suffix &quot;__encoded_mean&quot;. It has a method to control overfitting implemented via the argument smoothing. The integer value of this argument indicates a threshold in number of rows. Categories sized above this threshold are encoded with the group mean, while groups below it are encoded with a weighted mean of the group's mean and the global mean. This method is named &quot;mean smoothing&quot; in the relevant literature.
&quot;rank&quot; (implemented in target_encoding_rank()): Returns the rank of the group as a integer, being 1 he group with the lower mean of the reference variable. Variables encoded with this method are identified with the suffix &quot;__encoded_rank&quot;.
&quot;loo&quot; (implemented in target_encoding_loo()): Known as the &quot;leave-one-out method&quot; in the literature, it encodes each categorical value with the mean of the response variable across all other group cases. This method controls overfitting better than &quot;mean&quot;. Variables encoded with this method are identified with the suffix &quot;__encoded_loo&quot;.


Accepts a parallelization setup via future::plan() and a progress bar via progressr::handlers() (see examples)."><meta property="og:image" content="https://blasbenito.github.io/collinear/logo.png"><link rel="stylesheet" href="extra.css"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">collinear</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">3.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Tutorials</h6></li>
    <li><a class="dropdown-item" href="../articles/unified_correlation_framework.html">Unified Correlation Framework</a></li>
    <li><a class="dropdown-item" href="../articles/intelligent_predictor_ranking.html">Intelligent Predictor Ranking</a></li>
    <li><a class="dropdown-item" href="../articles/target_encoding.html">Target Encoding</a></li>
    <li><a class="dropdown-item" href="../articles/adaptive_filtering_thresholds.html">Adaptive Filtering Thresholds</a></li>
    <li><a class="dropdown-item" href="../articles/dual_filtering_strategy.html">Dual Filtering Strategy</a></li>
    <li><a class="dropdown-item" href="../articles/collinear_in_the_wild.html">collinear In The Wild</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-blog-posts" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Blog Posts</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-blog-posts"><li><a class="external-link dropdown-item" href="https://www.blasbenito.com/post/multicollinearity-model-interpretability/">Multicollinearity Hinders Model Interpretability</a></li>
    <li><a class="external-link dropdown-item" href="https://www.blasbenito.com/post/variance-inflation-factor/">Everything About Variance Inflation Factors</a></li>
    <li><a class="external-link dropdown-item" href="https://www.blasbenito.com/post/target-encoding/">Mapping Categorical Predictors to Numeric</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/blasbenito/collinear/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Convert categorical predictors to numeric via target encoding</h1>
      <small class="dont-index">Source: <a href="https://github.com/blasbenito/collinear/blob/v3.0.0/R/target_encoding_lab.R" class="external-link"><code>R/target_encoding_lab.R</code></a></small>
      <div class="d-none name"><code>target_encoding_lab.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Target encoding maps the values of categorical variables (of class <code>character</code> or <code>factor</code>) to numeric using another numeric variable as reference. The encoding methods implemented here are:</p>
<ul><li><p>"mean" (implemented in <code><a href="target_encoding_methods.html">target_encoding_mean()</a></code>): Maps each category to the average of reference numeric variable across the category cases. Variables encoded with this method are identified with the suffix "__encoded_mean". It has a method to control overfitting implemented via the argument <code>smoothing</code>. The integer value of this argument indicates a threshold in number of rows. Categories sized above this threshold are encoded with the group mean, while groups below it are encoded with a weighted mean of the group's mean and the global mean. This method is named "mean smoothing" in the relevant literature.</p></li>
<li><p>"rank" (implemented in <code><a href="target_encoding_methods.html">target_encoding_rank()</a></code>): Returns the rank of the group as a integer, being 1 he group with the lower mean of the reference variable. Variables encoded with this method are identified with the suffix "__encoded_rank".</p></li>
<li><p>"loo" (implemented in <code><a href="target_encoding_methods.html">target_encoding_loo()</a></code>): Known as the "leave-one-out method" in the literature, it encodes each categorical value with the mean of the response variable across all other group cases. This method controls overfitting better than "mean". Variables encoded with this method are identified with the suffix "__encoded_loo".</p></li>
</ul><p>Accepts a parallelization setup via <code><a href="https://future.futureverse.org/reference/plan.html" class="external-link">future::plan()</a></code> and a progress bar via <code><a href="https://progressr.futureverse.org/reference/handlers.html" class="external-link">progressr::handlers()</a></code> (see examples).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">target_encoding_lab</span><span class="op">(</span></span>
<span>  df <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  response <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  predictors <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  encoding_method <span class="op">=</span> <span class="st">"loo"</span>,</span>
<span>  smoothing <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  quiet <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-df">df<a class="anchor" aria-label="anchor" href="#arg-df"></a></dt>
<dd><p>(required; dataframe, tibble, or sf) A dataframe with responses
(optional) and predictors. Must have at least 10 rows for pairwise
correlation analysis, and <code>10 * (length(predictors) - 1)</code> for VIF.
Default: NULL.</p></dd>


<dt id="arg-response">response<a class="anchor" aria-label="anchor" href="#arg-response"></a></dt>
<dd><p>(optional, character string) Name of a numeric response variable in <code>df</code>. Default: NULL.</p></dd>


<dt id="arg-predictors">predictors<a class="anchor" aria-label="anchor" href="#arg-predictors"></a></dt>
<dd><p>(optional; character vector or NULL) Names of the
predictors in <code>df</code>. If NULL, all columns except <code>responses</code> and
constant/near-zero-variance columns are used. Default: NULL.</p></dd>


<dt id="arg-encoding-method">encoding_method<a class="anchor" aria-label="anchor" href="#arg-encoding-method"></a></dt>
<dd><p>(optional; character vector or NULL). Name of the target encoding methods. One or several of: "mean", "rank", "loo". If NULL, target encoding is ignored, and <code>df</code> is returned with no modification. Default: "loo"</p></dd>


<dt id="arg-smoothing">smoothing<a class="anchor" aria-label="anchor" href="#arg-smoothing"></a></dt>
<dd><p>(optional; integer vector) Argument of the method "mean". Groups smaller than this number have their means pulled towards the mean of the response across all cases. Default: 0</p></dd>


<dt id="arg-overwrite">overwrite<a class="anchor" aria-label="anchor" href="#arg-overwrite"></a></dt>
<dd><p>(optional; logical) If TRUE, the original predictors in <code>df</code> are overwritten with their encoded versions, but only one encoding method, smoothing, white noise, and seed are allowed. Otherwise, encoded predictors with their descriptive names are added to <code>df</code>. Default: FALSE</p></dd>


<dt id="arg-quiet">quiet<a class="anchor" aria-label="anchor" href="#arg-quiet"></a></dt>
<dd><p>(optional; logical) If FALSE, messages are printed. Default: FALSE.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>(optional) Internal args (e.g. <code>function_name</code> for
<code><a href="validate_arg_function_name.html">validate_arg_function_name</a></code>, a precomputed correlation matrix
<code>m</code>, or cross-validation args for <code><a href="preference_order.html">preference_order</a></code>).</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>dataframe</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>

<ul><li><p>Micci-Barreca, D. (2001) A Preprocessing Scheme for High-Cardinality Categorical Attributes in Classification and Prediction Problems. SIGKDD Explor. Newsl. 3, 1, 27-32. doi: 10.1145/507533.507538</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p>Other target_encoding:
<code><a href="target_encoding_methods.html">target_encoding_loo()</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Blas M. Benito, PhD</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">vi_smol</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#applying all methods for a continuous response</span></span></span>
<span class="r-in"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">target_encoding_lab</span><span class="op">(</span></span></span>
<span class="r-in"><span>  df <span class="op">=</span> <span class="va">vi_smol</span>,</span></span>
<span class="r-in"><span>  response <span class="op">=</span> <span class="st">"vi_numeric"</span>,</span></span>
<span class="r-in"><span>  predictors <span class="op">=</span> <span class="st">"koppen_zone"</span>,</span></span>
<span class="r-in"><span>  encoding_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="st">"mean"</span>,</span></span>
<span class="r-in"><span>    <span class="st">"loo"</span>,</span></span>
<span class="r-in"><span>    <span class="st">"rank"</span></span></span>
<span class="r-in"><span>  <span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> collinear::target_encoding_lab()</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> └── collinear::validate_arg_df(): converted the following character columns to factor:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  - koppen_zone</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> collinear::target_encoding_lab(): using response 'vi_numeric' to encode these categorical predictors:</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span>  - koppen_zone</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#identify encoded predictors</span></span></span>
<span class="r-in"><span><span class="va">predictors.encoded</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  pattern <span class="op">=</span> <span class="st">"*__encoded*"</span>,</span></span>
<span class="r-in"><span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  value <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">[</span>, <span class="va">predictors.encoded</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       koppen_zone__encoded_mean koppen_zone__encoded_loo</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17401                 0.3233333                0.3231250</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24388                 0.5233028                0.5225926</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4775                  0.6555814                0.6566667</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26753                 0.5233028                0.5237037</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13218                 0.6676000                0.6633333</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26109                 0.5233028                0.5225000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       koppen_zone__encoded_rank</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 17401                         7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 24388                         7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4775                          7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26753                         7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13218                         7</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 26109                         7</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://blasbenito.com" class="external-link">Blas M. Benito</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

